<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>지뢰 찾기</title>

  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <!-- 시작 화면 -->
  <div class="container">
    <h1>지뢰 찾기</h1>
    <div id="ready">
      <p>지뢰 찾기를 해봅시다</p>
      <button id="start-btn">시작</button>
    </div>
  
    <div id="start">
      <table id="table">
        <tbody></tbody>
      </table>
      <div id="result"></div>
    </div>
  </div>

  <script>
    const $ready = document.querySelector('#ready');
    const $start = document.querySelector('#start');

    const $tbody  = document.querySelector('#table tbody');
    const $result = document.querySelector('#result');

    const row  = 10; // 줄
    const cell = 10; // 칸
    const mine = 10; // 지뢰수
    const CODE = {
      NORMAL: -1,
      QUESTION: -2,
      FLAG: -3,
      QUESTION_MINE: -4,
      FLAG_MINE: -5,
      MINE: -6,
      OPENED: 0, // 0 이상이면 모두 열린 칸
    }
    let data;

    const plantMine = () => {
      // 전체 칸 만들기
      const candidate = Array(row * cell).fill().map((arr, i) => {
        return i;
      });

      // 섞기
      const shuffle = [];
      while (candidate.length > row * cell - mine) {
        const chosen = candidate.splice(Math.floor(Math.random() * candidate.length), 1)[0];
        shuffle.push(chosen);
      }

      // 전체 값
      const data = [];
      for (let i = 0; i < row; i++) {
        // 한 줄
        const rowData = [];
        data.push(rowData);
        for (let j = 0; j < cell; j++) {
          // 한 칸
          rowData.push(CODE.NORMAL);
        }
      }

      // 지뢰 심기
      for (let k = 0; k < shuffle.length; k++) {
        const ver = Math.floor(shuffle[k] / cell); // 가로
        const hor = shuffle[k] % cell; //세로
        data[ver][hor] = CODE.MINE;
      }

      return data;
    };


    const makeTable = () => {
      $tbody.innerHTML = '';
      data = plantMine();
      console.log(data);

      data.forEach(row => {
        const $tr = document.createElement('tr');

        row.forEach((cell) => {
          const $td = document.createElement('td');
          if (cell === CODE.MINE) {
            $td.textContent = 'X'; // 개발 편의를 위해
          }
          $tr.append($td);
        });
        $tbody.append($tr);
      });
    };

    function startGame() {
      makeTable();
    }

    function resetGame() {

      startGame();
    }
    

    const $startBtn = document.querySelector('#start-btn');
    $startBtn.addEventListener('click', startGame);

    const button = document.createElement('button');
    button.addEventListener('click', resetGame);
    button.textContent = '다시하기';
  </script>
</body>
</html>